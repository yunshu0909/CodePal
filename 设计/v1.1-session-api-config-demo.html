<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>API ÈÖçÁΩÆ - Session Áª¥Â∫¶ v0.11 Demo</title>
<style>
  /* ============================================================
     Design Tokens ‚Äî Cool Steel (from v0.7)
     ============================================================ */
  :root {
    --color-primary:        #2563eb;
    --color-primary-hover:   #1d4ed8;
    --color-primary-light:   #eff6ff;
    --text-primary:    #1a1d23;
    --text-secondary:  #5a6070;
    --text-tertiary:   #8b919a;
    --text-placeholder: #aab0ba;
    --bg-base:   #fff;
    --bg-subtle: #f8f9fb;
    --bg-muted:  #eef0f4;
    --border-light:   #f0f1f4;
    --border-default: #e2e5ea;
    --border-strong:  #cbd0d8;
    --color-success:    #16a34a;
    --color-success-bg: #f0fdf4;
    --color-danger:     #dc2626;
    --color-danger-bg:  #fef2f2;
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
    --font-mono:   'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
    --text-xl:  22px;
    --text-lg:  18px;
    --text-md:  15px;
    --text-base: 14px;
    --text-sm:  13px;
    --text-xs:  12px;
    --text-2xs: 11px;
    --space-1: 4px;
    --space-2: 8px;
    --space-3: 12px;
    --space-4: 16px;
    --space-5: 20px;
    --space-6: 24px;
    --space-7: 28px;
    --space-8: 32px;
    --radius-sm:   6px;
    --radius-md:   8px;
    --radius-lg:   10px;
    --radius-xl:   12px;
    --radius-2xl:  14px;
    --radius-3xl:  20px;
    --radius-full: 9999px;
    --shadow-card:  0 2px 20px rgba(0,0,0,0.05), 0 0 0 1px rgba(0,0,0,0.03);
    --shadow-modal: 0 10px 40px rgba(0,0,0,0.12);
    --transition-fast: 150ms ease;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font-family);
    background: var(--bg-muted);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: var(--space-5);
    color: var(--text-primary);
  }

  /* ============================================================
     Mac Window Frame (from v0.7)
     ============================================================ */
  .mac-window {
    width: 1000px;
    height: 720px;
    background: var(--bg-base);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-card);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .title-bar {
    height: 38px;
    background: var(--bg-subtle);
    border-bottom: 1px solid var(--border-default);
    display: flex;
    align-items: center;
    padding: 0 var(--space-4);
    -webkit-app-region: drag;
  }

  .traffic-lights {
    display: flex;
    gap: var(--space-2);
    -webkit-app-region: no-drag;
  }

  .traffic-light {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    box-shadow: inset 0 0 0 0.5px rgba(0, 0, 0, 0.1);
  }

  .traffic-light.close { background: #ff5f57; }
  .traffic-light.minimize { background: #febc2e; }
  .traffic-light.maximize { background: #28c840; }

  .title-text {
    flex: 1;
    text-align: center;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-secondary);
  }

  /* ============================================================
     Layout
     ============================================================ */
  .main-container {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  .sidebar {
    width: 180px;
    background: var(--bg-subtle);
    border-right: 1px solid var(--border-default);
    display: flex;
    flex-direction: column;
    padding: var(--space-3);
  }

  .sidebar-title {
    font-size: var(--text-2xs);
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0 var(--space-2) var(--space-2);
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
    font-size: var(--text-sm);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    font-family: var(--font-family);
  }

  .nav-item:hover { background: var(--bg-muted); }
  .nav-item.is-active {
    background: var(--bg-muted);
    color: var(--text-primary);
    font-weight: 600;
  }

  .nav-item__icon {
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .content {
    flex: 1;
    background: var(--bg-muted);
    overflow: auto;
    padding: var(--space-5);
  }

  /* ============================================================
     Dimension Switcher
     ============================================================ */
  .dimension-switcher {
    display: flex;
    gap: var(--space-1);
    margin-bottom: var(--space-5);
    padding: var(--space-1);
    background: var(--bg-base);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-card);
    width: fit-content;
  }

  .dimension-btn {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: 8px 16px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    background: transparent;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    font-family: var(--font-family);
  }

  .dimension-btn:hover { color: var(--text-primary); }
  .dimension-btn.is-active {
    background: var(--bg-subtle);
    color: var(--color-primary);
    font-weight: 600;
  }

  /* ============================================================
     [v0.7 Style] Global Config View - ÁôΩÊ°ÜÂ∏ÉÂ±Ä
     ============================================================ */
  .global-view {
    background: var(--bg-base);
    border-radius: var(--radius-3xl);
    box-shadow: var(--shadow-card);
    min-height: 100%;
    display: flex;
    flex-direction: column;
  }

  .global-view-content {
    max-width: 640px;
    margin: 0 auto;
    padding: var(--space-8);
    width: 100%;
  }

  .page-header {
    margin-bottom: var(--space-6);
  }

  .page-header h1 {
    font-size: var(--text-xl);
    font-weight: 700;
    letter-spacing: -0.5px;
    color: var(--text-primary);
  }

  .page-header p {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
    margin-top: var(--space-1);
  }

  .card {
    background: var(--bg-base);
    border-radius: var(--radius-2xl);
    border: 1.5px solid var(--border-default);
    overflow: hidden;
  }

  .status-card {
    padding: var(--space-4) var(--space-5);
    margin-bottom: var(--space-6);
    background: var(--bg-subtle);
    border-color: var(--border-light);
    border-radius: var(--radius-xl);
  }

  .status-label {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    font-weight: 500;
  }

  .status-value {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-primary);
    margin-top: var(--space-1);
  }

  .provider-section {
    margin-bottom: var(--space-5);
  }

  .section-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-3);
  }

  .provider-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .provider-item {
    display: flex;
    align-items: center;
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-xl);
    border: 1.5px solid transparent;
    background: var(--bg-subtle);
    transition: all var(--transition-fast);
    cursor: pointer;
    gap: var(--space-3);
  }

  .provider-item:hover {
    border-color: var(--border-default);
  }

  .provider-item.is-selected {
    background: var(--color-primary-light);
    border-color: #bfdbfe;
  }

  .provider-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-base);
    font-weight: 600;
    flex-shrink: 0;
    color: #fff;
  }

  .provider-info {
    flex: 1;
    min-width: 0;
  }

  .provider-name {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
  }

  .provider-url {
    font-size: var(--text-2xs);
    color: var(--text-tertiary);
    font-family: var(--font-mono);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .tag {
    display: inline-flex;
    align-items: center;
    padding: 3px 10px;
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: 500;
    transition: all var(--transition-fast);
    cursor: default;
    flex-shrink: 0;
  }

  .tag--success { color: var(--color-success); background: var(--color-success-bg); }
  .tag--neutral { color: var(--text-tertiary); background: var(--bg-muted); }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: 8px 16px;
    font-size: var(--text-sm);
    font-weight: 500;
    font-family: var(--font-family);
    border-radius: var(--radius-lg);
    border: 1.5px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
    line-height: 1.4;
  }

  .btn:active { transform: scale(0.98); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }

  .btn--primary {
    background: var(--color-primary);
    color: #fff;
    border-color: var(--color-primary);
  }
  .btn--primary:hover {
    background: var(--color-primary-hover);
    border-color: var(--color-primary-hover);
  }

  .btn--secondary {
    background: var(--bg-base);
    color: var(--text-secondary);
    border-color: var(--border-strong);
  }
  .btn--secondary:hover {
    background: var(--bg-subtle);
    border-color: var(--text-tertiary);
  }

  .btn--sm { padding: 6px 12px; font-size: var(--text-xs); }

  .token-panel {
    margin-top: var(--space-2);
    border-radius: var(--radius-xl);
    background: var(--bg-subtle);
    border: 1.5px solid var(--border-light);
    padding: var(--space-4);
    display: none;
  }

  .token-panel.is-open { display: block; }

  .field label {
    display: block;
    font-size: var(--text-2xs);
    color: var(--text-tertiary);
    font-weight: 600;
    letter-spacing: 0.3px;
    margin-bottom: var(--space-1);
    text-transform: uppercase;
  }

  .field input {
    width: 100%;
    padding: 9px 14px;
    font-size: var(--text-sm);
    font-family: var(--font-mono);
    color: var(--text-primary);
    background: var(--bg-base);
    border: 1.5px solid var(--border-default);
    border-radius: var(--radius-xl);
    outline: none;
    transition: all var(--transition-fast);
  }

  .field input:hover { border-color: var(--border-strong); }
  .field input:focus { border-color: var(--color-primary); background: var(--bg-base); }
  .field input::placeholder { color: var(--text-placeholder); }

  .field-note {
    margin-top: var(--space-2);
    font-size: var(--text-xs);
    color: var(--text-tertiary);
  }

  .actions {
    display: flex;
    gap: var(--space-2);
    margin-top: var(--space-3);
    justify-content: flex-end;
  }

  /* ============================================================
     [v1.1] Session Config View - Áªü‰∏ÄÂç°ÁâáÂ∏ÉÂ±Ä
     ============================================================ */
  .session-view {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
    background: var(--bg-base);
    border-radius: var(--radius-3xl);
    box-shadow: var(--shadow-card);
    overflow: hidden;
  }

  /* Top section: Project List + Session Content */
  .session-top-section {
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  /* Left: Project List */
  .projects-panel {
    width: 200px;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-light);
    flex-shrink: 0;
  }

  .projects-header {
    padding: var(--space-4);
    border-bottom: 1px solid var(--border-light);
  }

  .projects-title {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
  }

  .projects-subtitle {
    font-size: var(--text-2xs);
    color: var(--text-tertiary);
    margin-top: 2px;
  }

  .projects-list {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-2);
  }

  .project-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: 10px 12px;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .project-item:hover { background: var(--bg-subtle); }
  .project-item.is-active {
    background: var(--color-primary-light);
    outline: 1.5px solid #bfdbfe;
  }
  .project-item.is-active .project-name {
    color: var(--color-primary);
    font-weight: 600;
  }

  .project-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-md);
    background: var(--bg-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }

  .project-item.is-active .project-icon {
    background: var(--color-primary);
    color: #fff;
  }

  .project-group {
    margin-bottom: var(--space-3);
  }

  .project-group-title {
    font-size: var(--text-2xs);
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.3px;
    padding: var(--space-2) var(--space-3);
    margin-bottom: var(--space-1);
  }

  .project-group .project-item {
    margin-bottom: 2px;
  }

  .project-info { flex: 1; min-width: 0; }

  /* Selector Bar - Session dropdown */
  .selector-group {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .selector-label {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
    white-space: nowrap;
  }

  .selector-select {
    flex: 1;
    padding: 8px 12px;
    font-size: var(--text-sm);
    font-family: var(--font-family);
    color: var(--text-primary);
    background: var(--bg-subtle);
    border: 1.5px solid var(--border-default);
    border-radius: var(--radius-lg);
    outline: none;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .selector-select:hover { border-color: var(--border-strong); }
  .selector-select:focus { border-color: var(--color-primary); }

  .project-name {
    font-size: var(--text-sm);
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .project-meta {
    font-size: var(--text-2xs);
    color: var(--text-tertiary);
    margin-top: 1px;
  }

  /* Right: Content Area */
  .session-right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
  }

  /* Session Header - Top section of unified card */
  .session-header {
    padding: var(--space-4) var(--space-5);
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-base);
  }

  .session-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
  }

  .session-meta {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    margin-top: 2px;
  }

  /* Session Preview Card - Middle section of unified card */
  .session-preview-card {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  /* Config Section - Bottom (spans full width), fixed height */
  .config-section {
    padding: var(--space-4) var(--space-5);
    background: var(--bg-base);
    border-top: 1px solid var(--border-light);
    flex-shrink: 0;
  }

  .session-preview-header {
    padding: var(--space-4) var(--space-5);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .session-preview-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
  }

  .session-preview-meta {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
  }

  .session-preview-body {
    flex: 1;
    overflow-y: auto;
    padding: 0 var(--space-5) var(--space-5);
  }

  .conversation-preview {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .message-bubble {
    display: flex;
    gap: var(--space-3);
    align-items: flex-start;
  }

  .message-bubble.assistant {
    flex-direction: row-reverse;
  }

  .message-avatar {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .message-avatar.user {
    background: var(--bg-muted);
  }

  .message-avatar.assistant {
    background: var(--color-primary);
    color: #fff;
  }

  .message-content {
    flex: 1;
    max-width: 80%;
  }

  .message-text {
    font-size: var(--text-sm);
    color: var(--text-primary);
    line-height: 1.6;
    background: var(--bg-subtle);
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-xl);
    border-top-left-radius: var(--radius-sm);
  }

  .message-bubble.assistant .message-text {
    background: var(--color-primary-light);
    border-top-left-radius: var(--radius-xl);
    border-top-right-radius: var(--radius-sm);
  }

  .message-time {
    font-size: var(--text-2xs);
    color: var(--text-tertiary);
    margin-top: var(--space-1);
  }

  .message-code {
    background: rgba(0,0,0,0.04);
    border-radius: var(--radius-md);
    padding: var(--space-3);
    margin: var(--space-2) 0;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    overflow-x: auto;
    line-height: 1.5;
  }

  .message-inline-code {
    background: rgba(0,0,0,0.06);
    padding: 2px 6px;
    border-radius: var(--radius-sm);
    font-family: var(--font-mono);
    font-size: 0.9em;
  }

  /* Config Section - Bottom section of unified card */
  .config-section {
    padding: var(--space-4) var(--space-5);
    background: var(--bg-base);
  }

  .config-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-3);
  }

  .config-title {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
  }

  .config-current {
    font-size: var(--text-xs);
    color: var(--text-secondary);
  }

  .config-current strong {
    color: var(--color-primary);
  }

  .provider-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: var(--space-2);
    max-height: 220px;
    overflow-y: auto;
  }

  .provider-card {
    padding: var(--space-2);
    border: 1.5px solid var(--border-default);
    border-radius: var(--radius-xl);
    background: var(--bg-base);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: center;
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .provider-card:hover {
    border-color: var(--border-strong);
    background: var(--bg-subtle);
  }

  .provider-card.is-selected {
    border-color: var(--color-primary);
    background: var(--color-primary-light);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .provider-card__icon {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-2);
    font-size: 16px;
  }

  .provider-card.is-selected .provider-card__icon {
    background: var(--color-primary);
    color: #fff;
  }

  .provider-card__name {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-primary);
  }

  /* ============================================================
     Empty States
     ============================================================ */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-8);
    text-align: center;
    height: 100%;
  }

  .empty-state__icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-xl);
    background: var(--bg-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin-bottom: var(--space-4);
  }

  .empty-state__title {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-secondary);
  }

  .empty-state__desc {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    margin-top: var(--space-1);
  }

  /* ============================================================
     Hidden Helper
     ============================================================ */
  .hidden { display: none !important; }

  /* ============================================================
     Toast Container
     ============================================================ */
  .toast-container {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
    pointer-events: none;
  }

  .toast {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border-radius: var(--radius-xl);
    font-size: var(--text-sm);
    font-weight: 500;
    white-space: nowrap;
    animation: toast-in 300ms ease;
    pointer-events: auto;
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  .toast--success { background: var(--color-success); color: #fff; }
  .toast--error { background: var(--color-danger); color: #fff; }
  .toast--info { background: var(--color-primary); color: #fff; }

  @keyframes toast-in {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div class="mac-window">
  <div class="title-bar">
    <div class="traffic-lights">
      <div class="traffic-light close"></div>
      <div class="traffic-light minimize"></div>
      <div class="traffic-light maximize"></div>
    </div>
    <div class="title-text">API ÈÖçÁΩÆ - Session Áª¥Â∫¶ v0.11 Demo</div>
  </div>

  <div class="main-container">
    <aside class="sidebar">
      <div class="sidebar-title">Â∑•‰ΩúÁ©∫Èó¥</div>
      <button class="nav-item is-active" type="button">
        <span class="nav-item__icon">üîå</span>
        API ÈÖçÁΩÆ
      </button>
      <div style="flex:1"></div>
    </aside>

    <main class="content">
      <!-- Dimension Switcher -->
      <div class="dimension-switcher">
        <button class="dimension-btn is-active" id="btn-global" onclick="switchDimension('global')">
          <span>üåç</span> ÂÖ®Â±ÄÈÖçÁΩÆ
        </button>
        <button class="dimension-btn" id="btn-session" onclick="switchDimension('session')">
          <span>üìÅ</span> Session ÈÖçÁΩÆ
        </button>
      </div>

      <!-- [v0.7 Style] Global Config View -->
      <div id="globalView" class="global-view">
        <div class="global-view-content">
          <section class="page-header">
            <h1>API ÈÖçÁΩÆ</h1>
            <p>ÂàáÊç¢ Claude Code ÁöÑ API Êé•ÂÖ•ÁÇπ</p>
          </section>

          <section class="card status-card">
            <div class="status-label">ÂΩìÂâç‰ΩøÁî®</div>
            <div class="status-value" id="globalCurrentName">Kimi For Coding</div>
          </section>

          <section class="provider-section">
            <h2 class="section-title">ÈÄâÊã© API Êé•ÂÖ•ÁÇπ</h2>
            <div class="provider-list" id="globalProviderList">
              <!-- Provider items rendered by JS -->
            </div>
          </section>
        </div>
      </div>

      <!-- [v1.1 Style] Session Config View -->
      <div id="sessionView" class="session-view hidden">
        <!-- Top Section: Project List + Session Content -->
        <div class="session-top-section">
          <!-- Left: Project List -->
          <div class="projects-panel">
            <div class="projects-header">
              <div class="projects-title">È°πÁõÆÂàóË°®</div>
              <div class="projects-subtitle" id="projectsCount">8 ‰∏™È°πÁõÆ</div>
            </div>
            <div class="projects-list" id="projectsList">
              <!-- Projects rendered by JS -->
            </div>
          </div>

          <!-- Right: Session Content -->
          <div class="session-right-panel">
            <!-- Session Selector -->
            <div class="session-header">
              <div class="selector-group" style="width: 100%;">
                <span class="selector-label">Session</span>
                <select class="selector-select" id="sessionSelect" onchange="selectSession(this.value)" disabled>
                  <option value="">ÈÄâÊã© Session...</option>
                </select>
              </div>
            </div>

            <!-- Session Preview Card -->
            <div class="session-preview-card" id="previewCard">
              <div class="empty-state">
                <div class="empty-state__icon">üìÇ</div>
                <div class="empty-state__title">ÈÄâÊã©‰∏Ä‰∏™ Session</div>
                <div class="empty-state__desc">Âú®Â∑¶‰æßÈÄâÊã©È°πÁõÆÔºåÁÑ∂ÂêéÈÄâÊã© Session Êü•ÁúãËØ¶ÊÉÖ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Section: Config Provider (spans full width) -->
        <div class="config-section">
          <div class="config-header">
            <span class="config-title">ÈÖçÁΩÆ Provider</span>
            <span class="config-current">ÂΩìÂâç: <strong id="currentProviderName">Êú™ÈÖçÁΩÆ</strong></span>
          </div>
          <div class="provider-grid" id="sessionProviderGrid">
            <!-- Provider cards rendered by JS -->
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
  // Mock Data with lastModified (for time-based grouping)
  const projects = [
    { id: 'proj-1', name: 'skills', icon: '‚öõÔ∏è', path: '/Users/wuhaoyang/skills', lastModified: '2026-02-19T10:30:00' },
    { id: 'proj-2', name: 'todo-app', icon: '‚úÖ', path: '/Users/wuhaoyang/todo', lastModified: '2026-02-19T09:00:00' },
    { id: 'proj-3', name: 'data-analysis', icon: 'üìä', path: '/Users/wuhaoyang/data', lastModified: '2026-02-18T15:20:00' },
    { id: 'proj-4', name: 'docs-site', icon: 'üìö', path: '/Users/wuhaoyang/docs', lastModified: '2026-02-17T14:00:00' },
    { id: 'proj-5', name: 'ai-chatbot', icon: 'ü§ñ', path: '/Users/wuhaoyang/chatbot', lastModified: '2026-02-15T11:00:00' },
    { id: 'proj-6', name: 'e-commerce', icon: 'üõí', path: '/Users/wuhaoyang/ecom', lastModified: '2026-02-10T09:30:00' },
    { id: 'proj-7', name: 'blog-system', icon: 'üìù', path: '/Users/wuhaoyang/blog', lastModified: '2026-01-25T16:00:00' },
    { id: 'proj-8', name: 'weather-app', icon: 'üå§Ô∏è', path: '/Users/wuhaoyang/weather', lastModified: '2026-01-10T10:00:00' },
  ];

  // Parse Claude Code session data - content is array for assistant messages
  function parseClaudeSession(lines) {
    const messages = [];
    for (const line of lines.split('\n')) {
      if (!line.trim()) continue;
      try {
        const data = JSON.parse(line);
        if (data.type === 'user' && data.message?.content) {
          const content = data.message.content;
          if (content && !content.includes('<local-command') && !content.includes('<command')) {
            messages.push({
              role: 'user',
              content: content.substring(0, 150) + (content.length > 150 ? '...' : ''),
              time: data.timestamp?.substring(5, 16).replace('T', ' ') || ''
            });
          }
        } else if (data.type === 'assistant' && data.message?.content) {
          // Assistant content is an array of blocks
          const contentArr = data.message.content;
          if (Array.isArray(contentArr)) {
            // Extract text from text blocks, skip thinking and tool_use
            const textParts = contentArr
              .filter(block => block.type === 'text' && block.text)
              .map(block => block.text);
            if (textParts.length > 0) {
              const content = textParts.join('\n').substring(0, 200) + (textParts.join('\n').length > 200 ? '...' : '');
              messages.push({
                role: 'assistant',
                content: content,
                time: data.timestamp?.substring(5, 16).replace('T', ' ') || ''
              });
            }
          }
        }
        if (messages.length >= 8) break;
      } catch (e) {
        continue;
      }
    }
    return messages;
  }

  // Real session data from Claude Code
  const sessionsData = {
    'proj-1': [
      {
        id: 's1', name: 'v0.8 Áî®ÈáèÁõëÊµãËÆæËÆ°', messageCount: 8, created: '02-16 03:31', modified: '02-16 03:59', providerId: null,
        messages: [
          { role: 'user', content: 'bÂêß ÁÑ∂Âêé‰Ω†ÂçïÁã¨ÂºÄ‰∏Ä‰∏™v0.8ÁöÑÊñá‰ª∂ Â§çÂà∂Âá∫Êù•‰∏Ä‰ªΩÁî®ÈáèÁõëÊµã ÁÑ∂ÂêéÂú®‰∏äËæπÂä†Ëøô‰∏™ËÆæËÆ° ÊàëÂÖàÁúãÁúãËÆæËÆ°', time: '02-16 03:31' },
          { role: 'assistant', content: 'Ê†πÊçÆ CLAUDE.md ÁöÑËßÑÂàôÔºåËøôÊòØ‰∏Ä‰∏™ UI ËÆæËÆ°‰ªªÂä°ÔºåÊàëÂÖàËØªÂèñËÆæËÆ°ËßÑËåÉÊñá‰ª∂ÔºåÁÑ∂ÂêéÂ∏Æ‰Ω†ÁøªËØëÈúÄÊ±Ç„ÄÇ', time: '02-16 03:31' },
          { role: 'user', content: 'ÈÉΩÁî®Âì™‰∏™ÁôΩÂ∫ïÂëó ‰ºöÊúâ‰ªÄ‰πàÈóÆÈ¢òÂêó?', time: '02-16 03:39' },
          { role: 'assistant', content: 'ÊàëÊù•ËØªÂèñËÆæËÆ°ËßÑËåÉÊñá‰ª∂ÔºåÁúãÁúãÂÖ∑‰ΩìÁöÑËÆæËÆ°Ë¶ÅÊ±Ç„ÄÇ', time: '02-16 03:39' },
          { role: 'user', content: 'Êúâ‰ªÄ‰πàÂå∫Âà´ ÊàëÊ≤°ÊáÇ', time: '02-16 03:40' },
          { role: 'assistant', content: '‰∏ªË¶ÅÂå∫Âà´Âú®‰∫éËÉåÊôØËâ≤ÁöÑ‰ΩøÁî®„ÄÇÁôΩËâ≤ËÉåÊôØÈÄÇÂêàÂÜÖÂÆπÂå∫ÂüüÔºåÂèØ‰ª•Á™ÅÂá∫ÂÜÖÂÆπÊú¨Ë∫´„ÄÇÁÅ∞Ëâ≤ËÉåÊôØÈÄÇÂêà‰Ωú‰∏∫ÁîªÂ∏ÉÔºåËÆ©ÁôΩËâ≤Âç°ÁâáÊúâÂ±ÇÊ¨°ÊÑü„ÄÇ', time: '02-16 03:40' },
          { role: 'user', content: '‰Ω†Ê≤°ÁúãÂà∞Êï¥‰∏™È°µÈù¢Â∏ÉÂ±ÄÈÉΩÂá∫ÈóÆÈ¢ò‰∫ÜÂêó....‰Ω†ÂÖàËØ¥‰∏Ä‰∏ãÁé∞Âú®ÁöÑÈóÆÈ¢òÊòØ‰ªÄ‰πà', time: '02-16 03:46' },
          { role: 'assistant', content: 'Áé∞Âú®ÁöÑ‰∏ªË¶ÅÈóÆÈ¢òÊòØÂç°Áâá‰πãÈó¥ÁöÑÈó¥Ë∑ù‰∏ç‰∏ÄËá¥ÔºåÂØºËá¥ËßÜËßâ‰∏äÁöÑÊ∑∑‰π±„ÄÇÊàë‰ºöÈáçÊñ∞Ë∞ÉÊï¥Â∏ÉÂ±ÄÔºåÁ°Æ‰øùÁªü‰∏ÄÁöÑÈó¥Ë∑ùÂíåËæπË∑ù„ÄÇ', time: '02-16 03:46' },
        ]
      },
      {
        id: 's2', name: 'PRD ÊñáÊ°£Êõ¥Êñ∞', messageCount: 6, created: '02-18 11:29', modified: '02-18 11:43', providerId: null,
        messages: [
          { role: 'user', content: '"/Users/wuhaoyang/Documents/trae_projects/skills/ËÆæËÆ°/v0.9-Êñ∞Âª∫È°πÁõÆ/ÂºπÁ™óÂ±ïÁ§∫-ÊàêÂäüÂ§±Ë¥•.html"‰Ω†ÁúãÁúãËøô‰∏™Êñá‰ª∂ÁöÑÂÜÖÂÆπ ÈáåËæπÊúâ‰ªÄ‰πà?', time: '02-18 11:29' },
          { role: 'assistant', content: 'Ëøô‰∏™Êñá‰ª∂ÂåÖÂê´ÂºπÁ™óÁªÑ‰ª∂ÁöÑËÆæËÆ°ËßÑËåÉÔºåÂåÖÊã¨ÊàêÂäü„ÄÅÂ§±Ë¥•„ÄÅË≠¶Âëä‰∏âÁßçÁä∂ÊÄÅÁöÑÊ†∑ÂºèÂÆö‰πâ„ÄÇ', time: '02-18 11:30' },
          { role: 'user', content: '"skill-manager"‰Ω†Áúã‰∏Ä‰∏ã PRD ÊñáÊ°£', time: '02-18 11:30' },
          { role: 'assistant', content: 'PRD ÊñáÊ°£ÂåÖÂê´Êñ∞Âª∫È°πÁõÆ‰∏ÄÈîÆÂàùÂßãÂåñÁöÑËØ¶ÁªÜÈúÄÊ±Ç„ÄÇ‰∏ªË¶ÅÂäüËÉΩÂåÖÊã¨ÔºöÈ°πÁõÆÁªìÊûÑÁîüÊàê„ÄÅGit ÂàùÂßãÂåñ„ÄÅÊ®°ÊùøÊñá‰ª∂ÂàõÂª∫Á≠â„ÄÇ', time: '02-18 11:31' },
          { role: 'user', content: 'ÂàöÊâçÁöÑ‰øÆÊîπÊ¢≥ÁêÜ‰∏Ä‰∏ãÂêß Êàë‰ª¨Âú®prdÊõ¥Êñ∞‰∏Ä‰∏ã... ‰Ω†ÁúãÁúãË¶ÅÊõ¥Êñ∞Â§öÂ∞ëÂÜÖÂÆπ Êàë‰ª¨Á°ÆÂÆö‰∫ÜÊõ¥Êñ∞‰∏Ä‰∏ã', time: '02-18 11:43' },
          { role: 'assistant', content: 'ÈúÄË¶ÅÊõ¥Êñ∞ÁöÑÂÜÖÂÆπ‰∏ªË¶ÅÂåÖÊã¨Ôºö\n1. Ê∑ªÂä†ÂºπÁ™ó‰∫§‰∫íËÆæËÆ°ËØ¥Êòé\n2. Êõ¥Êñ∞È°πÁõÆÂàùÂßãÂåñÊµÅÁ®ã\n3. Ë°•ÂÖÖ Git Ê®°ÂºèÈÄâÊã©ÁöÑËØ¶ÁªÜÈÄªËæë', time: '02-18 11:43' },
        ]
      },
      {
        id: 's3', name: 'Ê®°ÂûãÂç†ÊØîÁªüËÆ°', messageCount: 6, created: '02-15 13:51', modified: '02-15 14:01', providerId: 'kimi',
        messages: [
          { role: 'user', content: 'codex 51% kimi 26% sonnet 18% opus 6% ÂÖ∂‰ªñ (1‰∏™Ê®°Âûã) 0% ÊàëÊÑüËßâÊ®°ÂûãÂç†ÊØîËøô‰∏™Êï∞ÊçÆÁªüËÆ°ÂíåÂ±ïÁ§∫ÊñáÊ°à‰∏çÊòØ‰∏ÄÂ•óÁΩóÂÆ∂...ËøôÊòØÊàëËßâÂæóÁöÑÈóÆÈ¢ò', time: '02-15 13:51' },
          { role: 'assistant', content: '‰Ω†ËØ¥ÂæóÂØπÔºåÊï∞ÊçÆÁªüËÆ°ÂíåÂ±ïÁ§∫ÈÄªËæëÁ°ÆÂÆûÈúÄË¶ÅÁªü‰∏Ä„ÄÇÂª∫ËÆÆË∞ÉÊï¥Â¶Ç‰∏ãÔºö\n1. Âè™Êúâ‰ΩøÁî®Ë∂ÖËøá 5 ‰∏™Ê®°ÂûãÊó∂ÊâçÊòæÁ§∫"ÂÖ∂‰ªñ"ÂàÜÁ±ª\n2. ÁôæÂàÜÊØîËÆ°ÁÆóÂü∫‰∫éÂÆûÈôÖËØ∑Ê±ÇÊ¨°Êï∞\n3. Â±ïÁ§∫ÊñáÊ°àÁªü‰∏Ä‰∏∫"X ‰∏™Ê®°Âûã"', time: '02-15 13:52' },
          { role: 'user', content: 'Â∞±ÊòØÂè™Êúâ5‰∏™ÊóßÈÉΩÂ±ïÁ§∫ Â§ß‰∫é5‰∏™ÂÜçËµ∞Ëøô‰∏™ÈÄªËæëÂêß Áé∞Âú®ÁöÑÈÄªËæëÂæà‰π± ÊàëÁúã‰∏çÊáÇ', time: '02-15 13:55' },
          { role: 'assistant', content: 'ÊòéÁôΩ‰∫ÜÔºåÊñ∞ÈÄªËæëÔºö\n- ‚â§5 ‰∏™Ê®°ÂûãÔºöÂÖ®ÈÉ®ÂçïÁã¨Â±ïÁ§∫\n- >5 ‰∏™Ê®°ÂûãÔºöÂ±ïÁ§∫Ââç 4 ‰∏™ + "ÂÖ∂‰ªñ (N ‰∏™Ê®°Âûã)"', time: '02-15 13:55' },
          { role: 'user', content: 'ÂèØ‰ª•', time: '02-15 13:56' },
          { role: 'user', content: '‰Ω†Á°ÆÂÆöÊòØ ‰ªäÂ§©ÂíåËøë‰∏ÉÂ§© Ëøë30Â§©ÈÉΩÊòØ‰∏Ä‰∏™ÈÄªËæë???', time: '02-15 13:58' },
        ]
      },
    ],
    'proj-2': [
      {
        id: 's4', name: 'Áî®ÈáèÁõëÊµãËÆæËÆ°ËÆ®ËÆ∫', messageCount: 4, created: '02-14 10:00', modified: '02-14 10:30', providerId: null,
        messages: [
          { role: 'user', content: 'Áî®ÈáèÁõëÊµãÈ°µÈù¢ÁöÑËÆæËÆ°ÊàëËßâÂæóÈúÄË¶ÅË∞ÉÊï¥‰∏Ä‰∏ã', time: '02-14 10:00' },
          { role: 'assistant', content: 'Â•ΩÁöÑÔºå‰Ω†ÊÉ≥Ë∞ÉÊï¥Âì™ÈÉ®ÂàÜÔºüÊòØÂ∏ÉÂ±Ä„ÄÅÈ¢úËâ≤ËøòÊòØ‰∫§‰∫íÔºü', time: '02-14 10:05' },
          { role: 'user', content: '‰∏ªË¶ÅÊòØÂ∏ÉÂ±ÄÔºåÊàëËßâÂæóÂç°ÁâáÂ§™Â§ö‰∫ÜÔºåÂ∫îËØ•Êï¥Âêà‰∏Ä‰∏ã', time: '02-14 10:15' },
          { role: 'assistant', content: 'Âª∫ËÆÆÊääÁõ∏ÂÖ≥ÊåáÊ†áÊï¥ÂêàÂà∞Âêå‰∏Ä‰∏™Âç°ÁâáÈáåÔºåÊØîÂ¶ÇÊää Token ‰ΩøÁî®Èáè„ÄÅËØ∑Ê±ÇÊ¨°Êï∞„ÄÅÊ®°ÂûãÂç†ÊØîÈÉΩÊîæÂú®‰∏Ä‰∏™"‰ΩøÁî®Ê¶ÇËßà"Âç°Áâá‰∏≠„ÄÇËøôÊ†∑‰ø°ÊÅØÊõ¥ÈõÜ‰∏≠ÔºåÈ°µÈù¢‰πüÊõ¥ÁÆÄÊ¥Å„ÄÇ', time: '02-14 10:30' }
        ]
      },
    ],
    'proj-3': [
      {
        id: 's5', name: 'API Key ÈÖçÁΩÆ', messageCount: 5, created: '02-13 09:00', modified: '02-13 10:00', providerId: 'aicodemirror',
        messages: [
          { role: 'user', content: 'ÊÄé‰πàÈÖçÁΩÆËá™ÂÆö‰πâ API KeyÔºü', time: '02-13 09:00' },
          { role: 'assistant', content: 'Âú®ËÆæÁΩÆÈ°µÈù¢ÁÇπÂáª "ÁºñËæë API Key" ÊåâÈíÆÔºåËæìÂÖ•‰Ω†ÁöÑ API Key Âêé‰øùÂ≠òÂç≥ÂèØ„ÄÇÈÖçÁΩÆ‰øùÂ≠òÂêé‰ºöËá™Âä®ÁîüÊïàÔºå‰∏çÈúÄË¶ÅÈáçÂêØÂ∫îÁî®„ÄÇ', time: '02-13 09:05' },
          { role: 'user', content: 'ÈÖçÁΩÆÂÆå‰∫ÜÊÄé‰πàÈ™åËØÅÊòØÂê¶ÁîüÊïàÔºü', time: '02-13 09:30' },
          { role: 'assistant', content: 'ÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÔºåÁúãÂìçÂ∫îÊó∂Èó¥ÂíåÊ®°ÂûãÂêçÁß∞Â∞±ËÉΩÂà§Êñ≠„ÄÇËá™ÂÆö‰πâ API ÈÄöÂ∏∏ÂìçÂ∫îÊõ¥Âø´ÔºåÊ®°ÂûãÂêçÁß∞‰ºöÊòæÁ§∫‰∏∫‰Ω†ÈÖçÁΩÆÁöÑ‰æõÂ∫îÂïÜÂêçÁß∞„ÄÇ', time: '02-13 09:31' },
          { role: 'user', content: 'Â•ΩÁöÑÊòéÁôΩ‰∫Ü', time: '02-13 10:00' }
        ]
      },
    ],
    'proj-4': [
      {
        id: 's6', name: 'ÊäÄËÉΩÂØºÂÖ•ÊµÅÁ®ã', messageCount: 6, created: '02-12 14:00', modified: '02-12 15:30', providerId: null,
        messages: [
          { role: 'user', content: 'ÊäÄËÉΩÂØºÂÖ•ÁöÑÂÖ∑‰ΩìÊµÅÁ®ãÊòØ‰ªÄ‰πàÔºü', time: '02-12 14:00' },
          { role: 'assistant', content: 'ÊäÄËÉΩÂØºÂÖ•ÊµÅÁ®ãÔºö\n1. Êâ´ÊèèÊú¨Âú∞ skills ÁõÆÂΩï\n2. ÊòæÁ§∫ÂèØÂØºÂÖ•ÁöÑÊäÄËÉΩÂàóË°®\n3. ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÊäÄËÉΩ\n4. Â§çÂà∂Âà∞‰∏≠Â§Æ‰ªìÂ∫ì\n5. Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂', time: '02-12 14:10' },
          { role: 'user', content: 'ËÉΩÊâπÈáèÂØºÂÖ•ÂêóÔºü', time: '02-12 14:30' },
          { role: 'assistant', content: 'ÂèØ‰ª•ÔºåÈÄâÊã©Â§ö‰∏™ÊäÄËÉΩÂêé‰∏ÄÈîÆÂØºÂÖ•„ÄÇÊîØÊåÅÂÖ®ÈÄâ„ÄÅÂèçÈÄâÁ≠âÊìç‰Ωú„ÄÇ', time: '02-12 15:00' },
          { role: 'user', content: 'ÂØºÂÖ•ÂêéÊÄé‰πàÈ™åËØÅÊàêÂäü‰∫ÜÔºü', time: '02-12 15:10' },
          { role: 'assistant', content: 'ÂØºÂÖ•ÊàêÂäüÂêé‰ºöÊòæÁ§∫ Toast ÊèêÁ§∫ÔºåÂêåÊó∂ÊäÄËÉΩÂàóË°®‰ºöÊõ¥Êñ∞„ÄÇÂèØ‰ª•Âú®ÁõÆÊ†áÂ∑•ÂÖ∑ÁöÑ skills ÁõÆÂΩï‰∏ãÁúãÂà∞ÂØπÂ∫îÁöÑÊñá‰ª∂Â§π„ÄÇ', time: '02-12 15:30' }
        ]
      },
    ],
    'proj-5': [
      {
        id: 's7', name: 'ChatBot Êû∂ÊûÑËÆæËÆ°', messageCount: 4, created: '02-15 10:00', modified: '02-15 11:00', providerId: null,
        messages: [
          { role: 'user', content: 'ËÆæËÆ°‰∏Ä‰∏™ AI ChatBot ÁöÑÊû∂ÊûÑ', time: '02-15 10:00' },
          { role: 'assistant', content: 'Âª∫ËÆÆÊû∂ÊûÑÔºöÂâçÁ´Ø React + ÂêéÁ´Ø Node.js + OpenAI API„ÄÇÈúÄË¶ÅÊîØÊåÅÊµÅÂºèËæìÂá∫Âíå‰∏ä‰∏ãÊñáËÆ∞ÂøÜ„ÄÇ', time: '02-15 10:15' },
          { role: 'user', content: '‰∏ä‰∏ãÊñáÊÄé‰πàÂ≠òÂÇ®Ôºü', time: '02-15 10:30' },
          { role: 'assistant', content: 'ÂèØ‰ª•Áî® Redis Â≠òÂÇ®Áü≠Êúü‰∏ä‰∏ãÊñáÔºåÊï∞ÊçÆÂ∫ìÂ≠òÂÇ®ÂéÜÂè≤ËÆ∞ÂΩï„ÄÇÊØè‰∏™Áî®Êà∑‰∏Ä‰∏™ session id„ÄÇ', time: '02-15 11:00' }
        ]
      },
    ],
    'proj-6': [
      {
        id: 's8', name: 'ÁîµÂïÜËÆ¢ÂçïÁ≥ªÁªü', messageCount: 3, created: '02-10 09:00', modified: '02-10 10:00', providerId: null,
        messages: [
          { role: 'user', content: 'ËÆæËÆ°ËÆ¢ÂçïÁä∂ÊÄÅÊú∫', time: '02-10 09:00' },
          { role: 'assistant', content: 'ËÆ¢ÂçïÁä∂ÊÄÅÔºöÂæÖÊîØ‰ªò ‚Üí Â∑≤ÊîØ‰ªò ‚Üí ÂæÖÂèëË¥ß ‚Üí Â∑≤ÂèëË¥ß ‚Üí Â∑≤ÂÆåÊàê„ÄÇÂºÇÂ∏∏ÂàÜÊîØÔºöÂèñÊ∂à„ÄÅÈÄÄÊ¨æ„ÄÇ', time: '02-10 09:20' },
          { role: 'user', content: 'ÈÄÄÊ¨æÊµÅÁ®ãÊÄé‰πàÂÅöÔºü', time: '02-10 09:30' }
        ]
      },
    ],
    'proj-7': [
      {
        id: 's9', name: 'ÂçöÂÆ¢ SEO ‰ºòÂåñ', messageCount: 5, created: '01-25 14:00', modified: '01-25 16:00', providerId: null,
        messages: [
          { role: 'user', content: 'ÊÄé‰πà‰ºòÂåñÂçöÂÆ¢ÁöÑ SEOÔºü', time: '01-25 14:00' },
          { role: 'assistant', content: 'SEO ‰ºòÂåñË¶ÅÁÇπÔºö\n1. ËØ≠‰πâÂåñ HTML\n2. ÂêàÁêÜÁöÑÊ†áÈ¢òÂ±ÇÁ∫ß\n3. meta Ê†áÁ≠æ\n4. ÂõæÁâá alt Â±ûÊÄß\n5. ÁΩëÁ´ôÂú∞Âõæ', time: '01-25 14:15' },
          { role: 'user', content: 'ÈúÄË¶Å SSR ÂêóÔºü', time: '01-25 15:00' },
          { role: 'assistant', content: 'ÊòØÁöÑÔºåSSR ÂØπ SEO ÂæàÈáçË¶Å„ÄÇÊêúÁ¥¢ÂºïÊìéÊõ¥ÂÆπÊòìÊäìÂèñÊ∏≤ÊüìÂêéÁöÑÂÜÖÂÆπ„ÄÇÊé®Ëçê Next.js„ÄÇ', time: '01-25 15:30' },
          { role: 'user', content: 'Â•ΩÁöÑ', time: '01-25 16:00' }
        ]
      },
    ],
    'proj-8': [
      {
        id: 's10', name: 'Â§©Ê∞î API Êé•ÂÖ•', messageCount: 3, created: '01-10 09:00', modified: '01-10 10:00', providerId: null,
        messages: [
          { role: 'user', content: 'Êé•ÂÖ•Â§©Ê∞î API', time: '01-10 09:00' },
          { role: 'assistant', content: 'Êé®Ëçê OpenWeatherMap ÊàñÂíåÈ£éÂ§©Ê∞î„ÄÇÈúÄË¶ÅÁî≥ËØ∑ API Key„ÄÇ', time: '01-10 09:10' },
          { role: 'user', content: 'ÊúâÂÖçË¥πÁöÑÂêóÔºü', time: '01-10 09:30' }
        ]
      },
    ],
  };

  const providers = [
    { id: 'official', name: 'Claude Official', url: 'https://www.anthropic.com/claude-code', icon: 'A', color: '#6b5ce7', token: '' },
    { id: 'kimi', name: 'Kimi For Coding', url: 'https://api.kimi.com/coding/', icon: 'K', color: '#4f46e5', token: 'sk-kimi-***' },
    { id: 'aicodemirror', name: 'AICodeMirror', url: 'https://api.aicodemirror.com/api/claudecode', icon: 'X', color: '#d97706', token: 'sk-ant-***' },
    { id: 'gemini', name: 'Gemini Pro', url: 'https://gemini.google.com', icon: 'G', color: '#10b981', token: '' },
    { id: 'openrouter', name: 'OpenRouter', url: 'https://openrouter.ai', icon: 'O', color: '#f59e0b', token: '' },
    { id: 'deepseek', name: 'DeepSeek', url: 'https://deepseek.com', icon: 'D', color: '#3b82f6', token: '' },
    { id: 'qwen', name: 'Qwen Max', url: 'https://qwen.aliyun.com', icon: 'Q', color: '#8b5cf6', token: '' },
    { id: 'mistral', name: 'Mistral Large', url: 'https://mistral.ai', icon: 'M', color: '#06b6d4', token: '' },
  ];

  // State
  let currentDimension = 'global';
  let globalProvider = 'kimi';
  let currentProjectId = null;
  let currentSessionId = null;
  let editingProvider = null;

  // Group projects by last modified time
  function groupProjectsByTime(projects) {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    const weekAgo = new Date(today);
    weekAgo.setDate(weekAgo.getDate() - 7);
    const monthAgo = new Date(today);
    monthAgo.setDate(monthAgo.getDate() - 30);

    const groups = {
      '‰ªäÂ§©': [],
      'Êò®Â§©': [],
      'Êú¨Âë®': [],
      'Êú¨Êúà': [],
      'Êõ¥Êó©': []
    };

    projects.forEach(p => {
      const modified = new Date(p.lastModified);
      if (modified >= today) {
        groups['‰ªäÂ§©'].push(p);
      } else if (modified >= yesterday) {
        groups['Êò®Â§©'].push(p);
      } else if (modified >= weekAgo) {
        groups['Êú¨Âë®'].push(p);
      } else if (modified >= monthAgo) {
        groups['Êú¨Êúà'].push(p);
      } else {
        groups['Êõ¥Êó©'].push(p);
      }
    });

    return groups;
  }

  // Init
  function init() {
    initProjectsList();
    renderGlobalView();

    // Session view: auto select first project and first session
    if (projects.length > 0) {
      selectProject(projects[0].id);
    }
  }

  // Initialize projects list (left panel) with time-based grouping
  function initProjectsList() {
    const list = document.getElementById('projectsList');
    const groups = groupProjectsByTime(projects);

    let html = '';
    for (const [groupName, groupProjects] of Object.entries(groups)) {
      if (groupProjects.length === 0) continue;

      html += `
        <div class="project-group">
          <div class="project-group-title">${groupName} (${groupProjects.length})</div>
          ${groupProjects.map(p => `
            <div class="project-item ${p.id === currentProjectId ? 'is-active' : ''}" data-id="${p.id}" onclick="selectProject('${p.id}')">
              <div class="project-icon">${p.icon}</div>
              <div class="project-info">
                <div class="project-name">${p.name}</div>
                <div class="project-meta">${sessionsData[p.id]?.length || 0} sessions</div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    list.innerHTML = html;
  }


  // Switch dimension
  function switchDimension(dim) {
    currentDimension = dim;
    document.getElementById('btn-global').classList.toggle('is-active', dim === 'global');
    document.getElementById('btn-session').classList.toggle('is-active', dim === 'session');
    document.getElementById('globalView').classList.toggle('hidden', dim !== 'global');
    document.getElementById('sessionView').classList.toggle('hidden', dim !== 'session');

    if (dim === 'global') {
      renderGlobalView();
    }
  }

  // ==================== Global View Functions ====================

  function renderGlobalView() {
    const list = document.getElementById('globalProviderList');
    list.innerHTML = '';

    providers.forEach(provider => {
      const isSelected = provider.id === globalProvider;
      const isEditing = provider.id === editingProvider;

      const item = document.createElement('div');
      item.className = `provider-item ${isSelected ? 'is-selected' : ''}`;
      item.innerHTML = `
        <div class="provider-icon" style="background: ${provider.color};">${provider.icon}</div>
        <div class="provider-info">
          <div class="provider-name">${provider.name}</div>
          <div class="provider-url">${provider.url}</div>
        </div>
        ${isSelected
          ? `<span class="tag tag--success">ÂΩìÂâç‰ΩøÁî®</span>
             ${provider.id !== 'official' ? `<button class="btn btn--secondary btn--sm edit-btn" data-id="${provider.id}">ÁºñËæë API Key</button>` : ''}`
          : `<button class="btn btn--primary btn--sm switch-btn" data-id="${provider.id}">ÂêØÁî®</button>`
        }
      `;

      item.addEventListener('click', (e) => {
        if (!e.target.closest('.btn')) {
          globalProvider = provider.id;
          editingProvider = null;
          renderGlobalView();
          showToast(`ÂÖ®Â±ÄÈªòËÆ§Â∑≤ÂàáÊç¢Âà∞ ${provider.name}`, 'success');
        }
      });

      list.appendChild(item);

      if (isEditing) {
        const panel = document.createElement('div');
        panel.className = 'token-panel is-open';
        panel.innerHTML = `
          <div class="field">
            <label>API Key</label>
            <input type="password" id="input-token-${provider.id}" value="${provider.token}" placeholder="ËæìÂÖ• API Key..." />
          </div>
          <p class="field-note">ÈÖçÁΩÆ‰øùÂ≠òËá≥ ~/.claude/settings.json</p>
          <div class="actions">
            <button class="btn btn--secondary btn--sm cancel-btn" data-id="${provider.id}">ÂèñÊ∂à</button>
            <button class="btn btn--primary btn--sm save-btn" data-id="${provider.id}">‰øùÂ≠ò</button>
          </div>
        `;
        list.appendChild(panel);
      }
    });

    document.getElementById('globalCurrentName').textContent = providers.find(p => p.id === globalProvider)?.name || '';

    // Bind events
    document.querySelectorAll('.switch-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        globalProvider = btn.dataset.id;
        editingProvider = null;
        renderGlobalView();
        showToast(`ÂÖ®Â±ÄÈªòËÆ§Â∑≤ÂàáÊç¢Âà∞ ${providers.find(p => p.id === btn.dataset.id)?.name}`, 'success');
      });
    });

    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        editingProvider = editingProvider === btn.dataset.id ? null : btn.dataset.id;
        renderGlobalView();
      });
    });

    document.querySelectorAll('.cancel-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        editingProvider = null;
        renderGlobalView();
      });
    });

    document.querySelectorAll('.save-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const id = btn.dataset.id;
        const tokenInput = document.getElementById(`input-token-${id}`);
        const provider = providers.find(p => p.id === id);
        if (provider && tokenInput) {
          provider.token = tokenInput.value;
        }
        editingProvider = null;
        renderGlobalView();
        showToast('API Key Â∑≤‰øùÂ≠ò', 'success');
      });
    });
  }

  // ==================== Session View Functions ====================

  function selectProject(projectId) {
    currentProjectId = projectId;

    // Update left panel highlight
    document.querySelectorAll('.project-item').forEach(item => {
      item.classList.toggle('is-active', item.dataset.id === projectId);
    });

    // Update session select dropdown
    const sessionSelect = document.getElementById('sessionSelect');
    sessionSelect.innerHTML = '<option value="">ÈÄâÊã© Session...</option>';
    sessionSelect.disabled = !projectId;

    // Populate sessions for this project
    if (projectId && sessionsData[projectId]) {
      sessionsData[projectId].forEach(s => {
        const option = document.createElement('option');
        option.value = s.id;
        option.textContent = s.name;
        sessionSelect.appendChild(option);
      });

      // Auto select first session
      if (sessionsData[projectId].length > 0) {
        const firstSessionId = sessionsData[projectId][0].id;
        sessionSelect.value = firstSessionId;
        selectSession(firstSessionId);
      }
    } else {
      currentSessionId = null;
      renderPreview(null);
      renderSessionProviders(null);
    }
  }

  function selectSession(sessionId) {
    currentSessionId = sessionId;

    const session = findSession(sessionId);
    renderPreview(session);
    renderSessionProviders(session);
  }

  function findSession(sessionId) {
    for (const projSessions of Object.values(sessionsData)) {
      const s = projSessions.find(sess => sess.id === sessionId);
      if (s) return s;
    }
    return null;
  }

  function renderPreview(session) {
    const card = document.getElementById('previewCard');

    if (!session) {
      card.innerHTML = `
        <div class="empty-state">
          <div class="empty-state__icon">üìÇ</div>
          <div class="empty-state__title">ÈÄâÊã©‰∏Ä‰∏™ Session</div>
          <div class="empty-state__desc">Âú®‰∏äÊñπÈÄâÊã© Session Êü•ÁúãËØ¶ÊÉÖ</div>
        </div>
      `;
      return;
    }

    // Build messages HTML
    const messagesHtml = session.messages.map(msg => `
      <div class="message-bubble ${msg.role}">
        <div class="message-avatar ${msg.role}">${msg.role === 'user' ? 'üë§' : 'ü§ñ'}</div>
        <div class="message-content">
          <div class="message-text">${formatMessageContent(msg.content)}</div>
          <div class="message-time" style="${msg.role === 'assistant' ? 'text-align: right;' : ''}">${msg.time}</div>
        </div>
      </div>
    `).join('');

    card.innerHTML = `
      <div class="conversation-preview">
        ${messagesHtml}
      </div>
    `;
  }

  // Format message content: preserve line breaks and code blocks
  function formatMessageContent(content) {
    // Escape HTML
    let html = content
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');

    // Highlight code blocks
    html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre class="message-code"><code>$2</code></pre>');

    // Handle inline code
    html = html.replace(/`([^`]+)`/g, '<code class="message-inline-code">$1</code>');

    // Preserve line breaks
    html = html.replace(/\n/g, '<br>');

    return html;
  }

  function renderSessionProviders(session) {
    const grid = document.getElementById('sessionProviderGrid');
    const currentId = session?.providerId || globalProvider;

    document.getElementById('currentProviderName').textContent = session
      ? (session.providerId ? providers.find(p => p.id === session.providerId)?.name + ' (Ëá™ÂÆö‰πâ)' : `Ë∑üÈöèÂÖ®Â±Ä (${providers.find(p => p.id === globalProvider)?.name})`)
      : 'Êú™ÈÖçÁΩÆ';

    grid.innerHTML = providers.map(p => `
      <div class="provider-card ${p.id === currentId ? 'is-selected' : ''}" onclick="${session ? `setSessionProvider('${p.id}')` : ''}">
        <div class="provider-card__icon" style="${p.id === currentId ? '' : `background: ${p.color}20; color: ${p.color};`}">${p.icon}</div>
        <div class="provider-card__name">${p.name}</div>
      </div>
    `).join('');
  }

  function setSessionProvider(providerId) {
    if (!currentSessionId) return;

    for (const projSessions of Object.values(sessionsData)) {
      const session = projSessions.find(s => s.id === currentSessionId);
      if (session) {
        session.providerId = providerId;
        break;
      }
    }

    const session = findSession(currentSessionId);
    renderSessionProviders(session);
    showToast(`Â∑≤‰∏∫ÂΩìÂâç Session ËÆæÁΩÆ ${providers.find(p => p.id === providerId)?.name}`, 'success');
  }

  // ==================== Common Functions ====================

  function showToast(msg, type = 'info') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast toast--${type}`;
    const icons = { success: '‚úì', error: '‚úï', info: '‚Ñπ' };
    toast.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }

  // Init
  init();
</script>

</body>
</html>
